<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#16151B">
  <meta name="format-detection" content="telephone=no">
  <meta name="format-detection" content="email=no">
  <link rel="icon" type="image/x-icon" href="/assets/imgs/91.ico">
  <title>天涯精选 - 地址发布页</title>
  <style>
    *, *:after, *:before { margin: 0; padding: 0; outline: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    ol, ul { list-style: none; }
    a { text-decoration: none; -webkit-tap-highlight-color: transparent; color: var(--text-color); }
    img { border: none; vertical-align: middle; max-width: 100%; }
    :root {
      --bg-color: #16151B;
      --text-color: #8F8F8F;
      --color-primary: #f70;
    }
    html {
      font-size: clamp(36px, 10vw, 50px);
      -webkit-text-size-adjust: 100%;
    }
    html, body {
      height: 100%;
      font-family: PingFang SC, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      overscroll-behavior: none;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100%;
      background-color: var(--bg-color);
      color: var(--text-color);
      background: linear-gradient(-135deg, #0f0b19, var(--bg-color));
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
    .page::-webkit-scrollbar { display: none; }
    .page {
      flex: 1;
      width: 100%;
      min-width: 0;
      max-width: 12rem;
      margin: 0 auto;
      padding: 0.2rem 0.5rem;
      padding-left: max(0.5rem, env(safe-area-inset-left, 0));
      padding-right: max(0.5rem, env(safe-area-inset-right, 0));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .nav-a {
      position: relative;
      border-radius: 0.36rem;
      padding: 1.4rem 0.32rem 0.32rem 0.32rem;
      margin-top: 0.3rem;
      background-color: rgba(255, 255, 255, 0.05);
      border: 0.02667rem solid rgba(255, 255, 255, 0.1);
      width: 100%;
      min-width: 0;
    }
    .nav-a .va-a {
      position: absolute;
      top: -0.9rem;
      left: calc((100% - 1.9rem) / 2);
      width: 1.9rem;
      height: 1.9rem;
    }
    .nav-a .va-a img { width: 100%; height: 100%; }
    .nav-a .va-b { font-size: 0.7rem; color: #fff; font-weight: 800; text-align: center; }
    .nav-a .va-c { padding: 0.16rem 0; font-size: 0.36rem; text-align: center; }
    .nav-a .va-d { font-weight: 600; color: #fff; font-size: 0.38rem; text-align: center; }
    .nav-a .va-g {
      margin: 0.85rem 0;
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.32rem;
    }
    .nav-a .va-g a {
      background-color: rgba(255, 255, 255, 0.05);
      border: 0.02667rem solid rgba(255, 255, 255, 0.1);
      padding: 0 0.06rem 0 0.24rem;
      min-height: 1.2rem;
      height: 1.2rem;
      line-height: 1.2rem;
      border-radius: 10.66667rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.2rem;
      color: #fff;
      font-size: 0.38rem;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      overflow: hidden;
    }
    .nav-a .va-g a .domain-text {
      flex: 1 1 0;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #fff;
      padding: 0 0.2rem 0 0;
      margin-right: 0.16rem;
      min-height: 1rem;
      line-height: 1rem;
      font-size: 0.38rem;
    }
    .nav-a .va-g a .copy-btn {
      flex-shrink: 0;
      min-width: 2.5rem;
      min-height: 1rem;
      height: 1rem;
      line-height: 1rem;
      border-radius: 1rem;
      padding: 0 0.36rem;
      text-align: center;
      background-color: var(--color-primary);
      color: #fff;
      font-size: 0.34rem;
      white-space: nowrap;
    }
    .nav-a .va-h { color: var(--color-primary); font-size: 0.38rem; text-align: center; padding: 0.32rem; }
    .nav-a .va-f { text-align: center; font-size: 0.34rem; }
    .nav-a .va-f span { display: block; margin-bottom: 0.28rem; }
    .nav-a .va-f span b { color: var(--color-primary); }
    .nav-a .va-f p { margin-top: 0.28rem; padding: 0.12rem 0.28rem; }
    .nav-b {
      margin-top: 0.25rem;
      background-color: rgba(255, 255, 255, 0.05);
      border: 0.02667rem solid rgba(255, 255, 255, 0.1);
      border-radius: 0.36rem;
      text-align: center;
      padding: 0.4rem;
      font-size: 0.34rem;
      width: 100%;
    }
    .toast {
      position: fixed;
      bottom: calc(1.2rem + env(safe-area-inset-bottom, 0));
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.28rem;
      font-size: 0.48rem;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 9999;
      max-width: 90vw;
    }
    .toast.show { opacity: 1; }
    @media (max-width: 360px) {
      .page { padding: 0.15rem 0.4rem; }
      .nav-a { padding: 1.2rem 0.24rem 0.24rem 0.24rem; margin-top: 0.2rem; }
      .nav-a .va-g a { padding: 0 0.04rem 0 0.2rem; }
      .nav-a .va-g a .domain-text { padding: 0 0.16rem 0 0; font-size: 0.34rem; }
      .nav-a .va-g a .copy-btn { min-width: 2.2rem; padding: 0 0.28rem; font-size: 0.3rem; }
    }
    @media (min-width: 768px) {
      html { font-size: 50px; }
      .page { max-width: 420px; padding: 0.3rem; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="nav-a">
      <div class="va-a"><img src="/assets/imgs/91.png" alt="logo" /></div>
      <div class="va-b">地址发布页</div>
      <div class="va-c">请 Ctrl+D 收藏本页到浏览器收藏夹回家不迷路</div>
      <div class="va-d">--点击下方按钮进入网站--</div>
      <div class="va-g">
        <a><span class="domain-text">努力加载中...</span><span class="copy-btn">复制网址</span></a>
        <a><span class="domain-text">努力加载中...</span><span class="copy-btn">复制网址</span></a>
      </div>
      <div class="va-h">请将以上网址复制浏览器打开</div>
      <div class="va-f">
        <span>收藏本站永久地址：<b>tyjx.app</b>，备用地址：<b>tycg.app</b>，防止失联！</span>
        <p>网站域名经常更新，防止网站打不开</p>
        <p>请务必收藏此网页，永久有效！</p>
      </div>
    </div>
    <div class="nav-b">
      安卓用户请使用谷歌(Chrome)浏览器访问<br />
      iphone用户请使用手机自带Safari浏览器访问<br />
      无广告、体验流畅、速度更快
    </div>
  </div>
  <div class="toast" id="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script src="/assets/js/crypto-util.js"></script>
  <script>
    const API_SECRET = 'ipu2s74rbl9odlleyt4aywm7sq2fxds2';

    function getDomainParam() {
      const urlParams = new URLSearchParams(window.location.search);
      let domain = urlParams.get('domain') || window.location.hostname;
      return domain.split('.').slice(-2).join('.');
    }

    function showToast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 2000);
    }

    (function () {
      const params = { Domain: getDomainParam() };
      const encrypted = cryptoUtil.encrypt(JSON.stringify(params), API_SECRET);
      const apiUrl = `${location.protocol}//${location.host}/Web/GetJumpURL2`;

      fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: encrypted,
      })
        .then((res) => {
          if (!res.ok) throw new Error('API error');
          return res.text();
        })
        .then((text) => {
          const decrypted = cryptoUtil.decrypt(text, API_SECRET);
          const json = JSON.parse(decrypted);
          if (json.code !== 0 || !json.data?.jumpDomains) throw new Error('Invalid response');
          const domains = String(json.data.jumpDomains).split(',').map((d) => (d || '').trim()).filter(Boolean);
          const items = document.querySelectorAll('.va-g a');
          items.forEach((item, i) => {
            const el = item.querySelector('.domain-text');
            if (el) el.textContent = domains[i] || '获取失败';
          });
          initCopy(items);
        })
        .catch(() => {
          document.querySelectorAll('.domain-text').forEach((el) => (el.textContent = '获取失败'));
        });
    })();

    function initCopy(items) {
      items.forEach((item) => {
        const copyBtn = item.querySelector('.copy-btn');
        const domainEl = item.querySelector('.domain-text');
        copyBtn.onclick = () => {
          const text = domainEl.textContent.trim();
          if (text === '获取失败' || text === '努力加载中...') return;
          navigator.clipboard.writeText(text).then(
            () => showToast('复制成功！'),
            () => showToast('复制失败，请手动复制')
          );
        };
      });
    }
  </script>
</body>
</html>
